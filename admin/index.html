<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BOLTHEX | Admin Console</title>
    <style>
        body { background: #050505; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .admin-card { background: #111; border: 1px solid #222; padding: 40px; border-radius: 20px; width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #333; border-radius: 8px; color: #fff; margin-bottom: 15px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #0ea5e9; border: none; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login-screen" class="admin-card">
        <h1 style="color:#0ea5e9">BOLTHEX</h1>
        <p style="font-size: 0.8rem; color: #666;">ENTER GITHUB TOKEN</p>
        <input type="password" id="token-input" placeholder="ghp_xxxxxxxxxxxx">
        <button onclick="unlock()">Unlock Dashboard</button>
    </div>

    <div id="nc-root"></div>

    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <script>
        // 2. This prevents the "collections must be unique" error
        window.CMS_MANUAL_INIT = true;

        function unlock() {
            const token = document.getElementById('token-input').value.trim();
            if (!token) return alert("Please enter your token");

            localStorage.setItem('bolthex_key', token);
            
            // Hide login UI
            document.getElementById('login-screen').classList.add('hidden');

            // 3. Initialize ONLY when button is clicked
            window.CMS.init({
                config: {
                    backend: {
                        name: "github",
                        repo: "aarshkashy-cmd/Test",
                        branch: "main",
                        token: token
                    },
                    load_config_file: false, // Disables looking for config.yml
                    display_url: "https://bolthex.in",
                    media_folder: "photo",
                    public_folder: "photo",
                    collections: [{
                        name: "gallery",
                        label: "Gallery Items",
                        folder: "photo",
                        create: true,
                        fields: [
                            {label: "Title", name: "title", widget: "string"},
                            {label: "Image", name: "image", widget: "image"}
                        ]
                    }]
                }
            });
        }

        // Auto-fill token if in browser memory
        const saved = localStorage.getItem('bolthex_key');
        if (saved) document.getElementById('token-input').value = saved;
    </script>
</body>
</html>
