<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
<script>
    function unlock() {
        const token = document.getElementById('token-input').value;
        if (!token) return alert("Please enter your Master Key");

        localStorage.setItem('bolthex_key', token);
        
        // Hide the login screen
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('nc-root').classList.remove('hidden');

        // IMPORTANT: Tell the CMS NOT to look for a config.yml file 
        // because we are providing the config right here in the code.
        window.CMS_MANUAL_INIT = true; 

        window.CMS.init({
            config: {
                backend: { 
                    name: "github", 
                    repo: "aarshkashy-cmd/Test", 
                    branch: "main", 
                    token: token 
                },
                load_config_file: false, // Prevents reading admin/config.yml
                media_folder: "photo",
                public_folder: "photo",
                collections: [{
                    name: "gallery_collection", // Unique name
                    label: "Bolthex Gallery",
                    folder: "photo",
                    create: true,
                    fields: [
                        {label: "Bolt Name", name: "title", widget: "string"},
                        {label: "Bolt Photo", name: "image", widget: "image"}
                    ]
                }]
            }
        });
    }

    const saved = localStorage.getItem('bolthex_key');
    if (saved) document.getElementById('token-input').value = saved;
</script>
