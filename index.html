<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

<script>
    // 1. This line is CRITICAL. It stops the "Double Loading" error.
    window.CMS_MANUAL_INIT = true; 

    function unlock() {
        const token = document.getElementById('token-input').value;
        if (!token) return alert("Please enter your Master Key");

        localStorage.setItem('bolthex_key', token);
        
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('nc-root').classList.remove('hidden');

        // 2. Start the CMS manually using the token provided
        window.CMS.init({
            config: {
                backend: { 
                    name: "github", 
                    repo: "aarshkashy-cmd/Test", 
                    branch: "main", 
                    token: token 
                },
                // Prevents the CMS from looking for a config.yml file
                load_config_file: false, 
                media_folder: "photo",
                public_folder: "photo",
                collections: [{
                    name: "bolthex_gallery", 
                    label: "Bolthex Gallery",
                    folder: "photo",
                    create: true,
                    fields: [
                        {label: "Bolt Name", name: "title", widget: "string"},
                        {label: "Bolt Photo", name: "image", widget: "image"}
                    ]
                }]
            }
        });
    }

    const saved = localStorage.getItem('bolthex_key');
    if (saved) document.getElementById('token-input').value = saved;
</script>
